echo "ğŸ›¡ï¸  Running Security Scans (Pre-Push)..."

# 1. Semgrep SAST
if command -v semgrep >/dev/null 2>&1; then
  echo "ğŸ” Running Semgrep (SAST)..."
  bun run security:semgrep
  if [ $? -ne 0 ]; then
    echo "âŒ Semgrep found security issues! Please fix them before pushing."
    exit 1
  fi
else
  echo "âš ï¸  Semgrep not found in PATH. Skipping SAST scan. (Install via 'brew install semgrep')"
fi

# 2. Snyk Code SAST
# Check if user is authenticated with Snyk
if bunx snyk auth --test >/dev/null 2>&1 || [ -n "$SNYK_TOKEN" ]; then
    echo "ğŸ¶ Running Snyk Code..."
    bun run security:snyk
    if [ $? -ne 0 ]; then
      echo "âŒ Snyk found critical vulnerabilities! Please fix them before pushing."
      exit 1
    fi
else
    echo "âš ï¸  Snyk is not authenticated. Skipping Snyk scan. (Run 'snyk auth' to enable)"
fi

echo "âœ… Security checks passed!"
